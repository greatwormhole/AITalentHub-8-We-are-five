# Чат-бот **AI Talent Hub**

## Использованные технологии

- **Frontend:**
  - React.js

- **Backend:**
  - FastAPI

## Установка

Чтобы установить проект необходимо:

1. **Клонировать репозиторий:**

   ```bash
   git clone https://github.com/greatwormhole/AITalentHub-8-We-are-five.git
   ```

2. **Настроить проект:**

    Перейти в склонированный репозиторий:
    ```bash
    cd AITalentHub-8-We-are-five
    ```

    Опционально изменить переменные окружения в файлах ```.env```, ```src/backend/.env/``` или ```src/frontend/.env```
    Для корректной работы следует вместо ```HOST``` в файле .env выставить значения IP адресов своего сервера
    Если настроена работа через github actions можно в репозитории указать секреты: SSH_PRIVATE_KEY - приватный ключ доступа на сервер, SERVER_IP и SERVER_USER - под каким пользователем подключатсья к серверу и какой IP у сервера; А также переменную окружения BACKEND_PORT И FRONTEND_PORT для указания портов обращения к сервисам

3. **Запустить приложение:**
    ```bash
    sudo bash launch.sh
    ```

## Использование

<div style="text-align: center;">
  <img src="./media/frontend.png" alt="Мое изображение" style="height: 400px; width: 600px; text-align: center;">
  <img src="./media/backend_docs.png" alt="Мое изображение" style="height: 400px; width: 800px; text-align: center;">
</div>

# Бейзлайн модель QueryFinder

## Обзор модели

Основой чат-бота является модель `all-mpnet-base-v2` из`SentenceTransformer`. Она сравнивает входные запросы с предварительно закодированным корпусом возможных запросов и извлекает наиболее семантически похожий. Для сравнения используется косинусное сходство.

### Компоненты

1. **Класс QueryFinder**  
   Класс `QueryFinder` отвечает за загрузку модели, обработку запросов и получение ответов. Он принимает следующие аргументы:
   - `model_path`: Путь к предобученной модели.
   - `embeddings_base_path`: Путь к предварительно вычисленным эмбеддингам корпуса запросов.
   - `answer_corpus_base_path`: Путь к корпусам ответов в формате pickle или JSON.
   - `closest_n`: Количество ближайших совпадений запросов для возврата (по умолчанию 1).

2. **Методы**
   - `_load_embeddings(category: str)`: Загружает эмбеддинги для указанной категории или всех категорий.
   - `_load_answer_corpus(category: str)`: Загружает корпус ответов для указанной категории.
   - `find_query(query: str, category: str)`: Находит ближайший запрос для данного запроса и категории. Возвращает наиболее похожий запрос и соответствующий ему ответ. Если сходство ниже установленного порога (0.85), бот просит пользователя переформулировать вопрос.

## Файлы и структура данных

Чат-бот зависит от предварительно вычисленных эмбеддингов и заранее созданного корпуса ответов. Вот обзор необходимых файлов:
- **Эмбеддинги корпуса запросов**
  - Хранятся в виде файлов `.pt` (тензоры PyTorch).
  - Основные эмбеддинги корпуса хранятся в `query_corpus_embeddings.pt`.
  - Эмбеддинги для категорий находятся в папке `query_corpus_embeddings_by_category`.
  
- **Корпус ответов**
  - Для основной категории корпус ответов хранится в виде файла pickle (`answer_corpus.pkl`).
  - Для запросов по категориям ответы хранятся в `answer_corpus_dict.json`.

## Пример использования

Пример использования класса `QueryFinder`:

```python
# Инициализация QueryFinder
query_finder = QueryFinder(
    model_path='path/to/sentence-transformer-model',
    embeddings_base_path='path/to/embeddings',
    answer_corpus_base_path='path/to/answer/corpus',
    closest_n=1
)

# Поиск совпадения по запросу
query = "Как сбросить пароль?"
category = "Общее"
answer = query_finder.find_query(query, category)

print(answer)
```

## Производительность и улучшения

- **Порог сходства**: В настоящее время порог косинусного сходства установлен на уровне 0.85, что означает, что любое совпадение ниже этого значения приведет к просьбе переформулировать вопрос. Этот порог можно изменить в зависимости от требований системы.
- **Категории запросов**: Модель поддерживает несколько категорий запросов. Указание категории позволяет сузить пространство поиска и повысить производительность.
  
### Возможные улучшения:
- **Множественные совпадения**: Возможность возврата нескольких совпадений, если оценки сходства близки.
- **Дополнительные модели фильтрации нерелевантных запросов от пользователя**
---

## Зависимости

- `torch`
- `sentence-transformers`
- `pickle`
- `json`

Установите необходимые зависимости с помощью:

```bash
pip install torch sentence-transformers
```